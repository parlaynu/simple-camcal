# The Tools


## Viewer

The viewer is a simple tool to display images captured from the camera. You can optionally pass in
a calibration configuration as generated by the calibration tool, and it has flags to flip the
image horizontally and vertically.

It uses gstreamer's python bindings to build a display pipeline with Nvidia's deepstream nodes as well as 
some standard nodes to display the camera input in real-time.

Usage is:

    $ ./viewer.py -h
    usage: viewer.py [-h] [--hflip] [--vflip] [--mode [{2,3,4,5}]] [calconfig]
    
    positional arguments:
      calconfig           calibration config file
    
    optional arguments:
      -h, --help          show this help message and exit
      --hflip             horizontal flip
      --vflip             vertical flip
      --mode [{2,3,4,5}]  the camera mode (default: 2)

An example usage to load calibration data and flip the display is:

    ./viewer.py --hflip config.txt

## Capture

The capture tool captures images and saves to a timestamped directory under the capture root parameter
supplied on the command line.

The full usage information is:

    $ ./capture.py -h
    usage: capture.py [-h] [-n NUM_IMAGES] [-t TIME_DELAY] [--hflip]
                      [--mode [{2,3,4,5}]]
                      capture_root
    
    positional arguments:
      capture_root          root directory to save captured images
    
    optional arguments:
      -h, --help            show this help message and exit
      -n NUM_IMAGES, --num-images NUM_IMAGES
                            number of calibration of images to capture in timed-
                            capture mode
      -t TIME_DELAY, --time-delay TIME_DELAY
                            seconds between images in timed-capture mode
      --hflip               horizontal flip the image (but not the captured data)
      --mode [{2,3,4,5}]    the camera mode (default: 2)

 
The horizontal flip (--hflip) option is useful to simplify capturing if you're watching what you 
are doing on the screen. Note that this only flips the display of the images, not the saved images.

The tool can run in two modes - manual or automatic. To run in manual mode, use a command
like this:

    $ ./capture.py --hflip ../images

This will capture images on a key press of 'c' or 'space' and will finish on 'q'.

To run in automatic mode:

    # ./capture.py --hflip -n 20 -t 10 ../images

This will capture 20 images on 10 second intervals. There is a traffic light countdown on the screen
that progresses from red, yellow, green as it counts down - the final second there is no traffic light
to indicate that the capture is about to happen.


## Calibrate

The calibrate tool processes the captured images and generations a calibration file that can be used
by the viewer. The viewer is also a simple example of how to use the calibration in another tool.

The full help information is:

    $ ./calibrate.py -h
    usage: calibrate.py [-h] [-x GRID_X] [-y GRID_Y] [-g GRID_SIZE] [-s] [-d]
                        image_dir
                        
    positional arguments:
      image_dir             location of images
      
    optional arguments:
      -h, --help            show this help message and exit
      -x GRID_X, --grid-x GRID_X
                            number of internal grid corners in x dimension
      -y GRID_Y, --grid-y GRID_Y
                            number of internal grid corners in y dimension
      -g GRID_SIZE, --grid-size GRID_SIZE
                            size of the grid squares in real-world units
      -s, --use-sb-alg      use the sector based algorithm to detect corners
      -d, --display         display results of processing
  
You need to specify how many internal grid corners are in the chessboard that is being used and the
real-world size of the squares on the chessboard.

Note that if you plan to use sector based corner detection, you need a chessboard with rounded external corners 
as described [here](https://docs.opencv.org/4.x/d9/d0c/group__calib3d.html#gadc5bcb05cb21cf1e50963df26986d7c9).


## Recorder

Records some images to disk, specifying a calibration file is optional as with the viewer application.

    usage: recorder.py [-h] [-n NUM_IMAGES] [-t TIME_DELAY] [--mode [{2,3,4,5}]]
                       capture_root [calconfig]
                       
    positional arguments:
      capture_root          root directory to save captured images
      calconfig             calibration config file
      
    optional arguments:
      -h, --help            show this help message and exit
      -n NUM_IMAGES, --num-images NUM_IMAGES
                            number of calibration of images to capture in timed-
                            capture mode
      -t TIME_DELAY, --time-delay TIME_DELAY
                            seconds between images in timed-capture mode
      --mode [{2,3,4,5}]    the camera mode (default: 2)

